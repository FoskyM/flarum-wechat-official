(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>h});const a=flarum.core.compat["common/extend"],n=flarum.core.compat["common/components/EditUserModal"];var i=t.n(n);const o=flarum.core.compat["common/extenders"];var r=t.n(o);function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)}const l=flarum.core.compat["common/Model"];var f=t.n(l),u=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).user_id=f().attribute("user_id"),e.wechat_open_id=f().attribute("wechat_open_id"),e.wechat_original_data=f().hasOne("wechat_original_data"),e}return c(e,t),e}(f()),d=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).openid=f().attribute("openid"),e.nickname=f().attribute("nickname"),e.sex=f().attribute("sex"),e.language=f().attribute("language"),e.city=f().attribute("city"),e.province=f().attribute("province"),e.country=f().attribute("country"),e.headimgurl=f().attribute("headimgurl"),e.privilege=f().attribute("privilege"),e}return c(e,t),e}(f());const h=[(new(r().Store)).add("wechat_link",u).add("wechat_original_data",d)],p=flarum.core.compat["common/models/User"];t.n(p)().prototype.WechatAuth=f().attribute("WechatAuth"),(0,a.extend)(i().prototype,"fields",(function(t){this.attrs.user,this.attrs.user.canEditCredentials()&&this.attrs.user.WechatAuth().wechat_open_id&&t.add("wechat-official-openid",m("div",{className:"Form-group"},m("label",null,"公众号 Openid"),m("input",{className:"FormControl",placeholder:"公众号 Openid",readonly:!0,value:this.attrs.user.WechatAuth().wechat_open_id})))}));const g=flarum.core.compat["admin/app"];var _=t.n(g);const y=flarum.core.compat["admin/components/ExtensionPage"];var b=t.n(y);const w=flarum.core.compat["common/components/Button"];var v=t.n(w);const k=flarum.core.compat["admin/components/AdminPage"];var x=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).user=_().session.user,e}c(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e)},a.refresh=function(){m.redraw()},a.header=function(t){return m("[",null)},a.content=function(){var t=_().extensionData.getSettings("foskym-wechat-official");return m("div",{className:"ExtensionPage-settings"},m("div",{className:""},m("div",{className:"Form"},t.map(this.buildSettingComponent.bind(this)),this.submitButton())))},a.saveSettings=function(e){var a=this;return t.prototype.saveSettings.call(this,e).then((function(){return a.refresh()}))},e}(t.n(k)());const N=flarum.core.compat["common/components/Page"];var S=t.n(N);const O=flarum.core.compat["common/utils/extractText"];var P=t.n(O);const A=flarum.core.compat["common/helpers/icon"];var F=t.n(A),C=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).translationPrefix="foskym-wechat-official.admin.other.",e}c(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e)},a.view=function(){return m("div",{class:"WechatOfficial-ListPage"},m(v(),{className:"Button Button--danger",onclick:this.deleteQRCode.bind(this)},F()("fas fa-trash"),_().translator.trans("foskym-wechat-official.admin.other.delete_qrcode_cache")),m(v(),{className:"Button Button--danger",onclick:this.deleteWechatLink.bind(this)},F()("fas fa-trash"),_().translator.trans("foskym-wechat-official.admin.other.delete_wechat_link")))},a.deleteQRCode=function(){window.confirm(P()(_().translator.trans("foskym-wechat-official.admin.other.delete_qrcode_cache_confirm")))&&_().request({method:"DELETE",url:_().forum.attribute("apiUrl")+"/wechat-official/qrcode"}).then((function(){_().alerts.show({type:"success"},_().translator.trans("foskym-wechat-official.admin.other.delete_qrcode_cache_success")),m.redraw()}))},a.deleteWechatLink=function(){window.confirm(P()(_().translator.trans("foskym-wechat-official.admin.other.delete_wechat_link_confirm")))&&_().request({method:"DELETE",url:_().forum.attribute("apiUrl")+"/wechat-official/qrcode"}).then((function(){_().alerts.show({type:"success"},_().translator.trans("foskym-wechat-official.admin.other.delete_wechat_link_success")),m.redraw()}))},e}(S()),E=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).translationPrefix="foskym-wechat-official.admin.pages.",e.pages={index:x,other:C},e.icons={index:"home",other:"cog"},e}c(e,t);var a=e.prototype;return a.content=function(){var t=m.route.param().page||"index";return m("div",{className:"ExtensionPage-settings WechatOfficial"},m("div",{className:"WechatOfficial-menu"},m("div",{className:"container"},this.menuButtons(t))),m("div",{className:"container WechatOfficial-container"},this.pageContent(t)))},a.menuButtons=function(t){var e=this;return Object.keys(this.pages).map((function(a){return v().component({className:"Button "+(t===a?"item-selected":""),onclick:function(){return m.route.set(_().route("extension",{id:"foskym-wechat-official",page:a}))},icon:e.iconForPage(a)},_().translator.trans(e.translationPrefix+a))}))},a.iconForPage=function(t){return"fas fa-"+this.icons[t]||0},a.pageContent=function(t){var e=this.pages[t];return e?m(e,null):null},e}(b());_().initializers.add("foskym/flarum-wechat-official",(function(){_().extensionData.for("foskym-wechat-official").registerPage(E).registerSetting({setting:"foskym-wechat-official.develop_mode",label:_().translator.trans("foskym-wechat-official.admin.settings.develop_mode_label"),help:_().translator.trans("foskym-wechat-official.admin.settings.develop_mode_description"),type:"boolean"}).registerSetting((function(){var t=this.setting("foskym-wechat-official.develop_mode")();return"0"===t&&(t=!1),m("[",null,m("div",{className:"Form-group"},m("label",null,_().translator.trans("foskym-wechat-official.admin.settings.app_id_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.app_id"+(t?"_dev":""))})),m("div",{className:"Form-group"},m("label",null,_().translator.trans("foskym-wechat-official.admin.settings.app_secret_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.app_secret"+(t?"_dev":""))})),m("div",{className:"Form-group"},m("label",null,_().translator.trans("foskym-wechat-official.admin.settings.token_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.token"+(t?"_dev":""))})),m("div",{className:"Form-group"},m("label",null,_().translator.trans("foskym-wechat-official.admin.settings.aes_key_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.aes_key"+(t?"_dev":""))})))})).registerSetting({setting:"foskym-wechat-official.server_url",label:_().translator.trans("foskym-wechat-official.admin.settings.server_url_label"),help:location.origin+"/api/wechat-official/ping",type:"hidden"}).registerSetting({setting:"foskym-wechat-official.callback_url",label:_().translator.trans("foskym-wechat-official.admin.settings.callback_url_label"),help:_().translator.trans("foskym-wechat-official.admin.settings.callback_url_description"),type:"hidden"}).registerSetting((function(){var t=this.setting("foskym-wechat-official.develop_mode")();if("0"===t&&(t=!1),t)return m("div",{className:"Form-group"},m("label",null,_().translator.trans("foskym-wechat-official.admin.settings.template_message_id_label")),m("div",{class:"helpText"},_().translator.trans("foskym-wechat-official.admin.settings.template_message_id_description")),m("div",{class:"helpText"},"【标题: {{thing01.DATA}} 内容: {{thing02.DATA}} 时间: {{time01.DATA}}\t】"),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.template_message_id")}))})).registerSetting({setting:"foskym-wechat-official.enable_push",label:_().translator.trans("foskym-wechat-official.admin.settings.enable_push_label"),type:"boolean"}).registerSetting({setting:"foskym-wechat-official.enable_login_replace",label:_().translator.trans("foskym-wechat-official.admin.settings.enable_login_replace_label"),help:_().translator.trans("foskym-wechat-official.admin.settings.enable_login_replace_description"),type:"boolean"}).registerSetting({setting:"foskym-wechat-official.enable_unbind",label:_().translator.trans("foskym-wechat-official.admin.settings.enable_unbind_label"),type:"boolean"}).registerSetting({setting:"foskym-wechat-official.template_message_api_token",label:_().translator.trans("foskym-wechat-official.admin.settings.template_message_api_token_label"),help:location.origin+"/api/wechat-official/template-message",type:"text"})}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map