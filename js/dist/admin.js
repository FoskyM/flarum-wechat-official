(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>f});const a=flarum.core.compat["common/extenders"];var n=t.n(a);function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}const r=flarum.core.compat["common/Model"];var s=t.n(r),c=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).user_id=s().attribute("user_id"),e.wechat_open_id=s().attribute("wechat_open_id"),e.wechat_original_data=s().hasOne("wechat_original_data"),e}return o(e,t),e}(s()),l=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).openid=s().attribute("openid"),e.nickname=s().attribute("nickname"),e.sex=s().attribute("sex"),e.language=s().attribute("language"),e.city=s().attribute("city"),e.province=s().attribute("province"),e.country=s().attribute("country"),e.headimgurl=s().attribute("headimgurl"),e.privilege=s().attribute("privilege"),e}return o(e,t),e}(s());const f=[(new(n().Store)).add("wechat_link",c).add("wechat_original_data",l)],u=flarum.core.compat["admin/app"];var d=t.n(u);const h=flarum.core.compat["admin/components/ExtensionPage"];var p=t.n(h);const g=flarum.core.compat["common/components/Button"];var y=t.n(g);const _=flarum.core.compat["admin/components/AdminPage"];var b=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).user=d().session.user,e}o(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e)},a.refresh=function(){m.redraw()},a.header=function(t){return m("[",null)},a.content=function(){var t=d().extensionData.getSettings("foskym-wechat-official");return m("div",{className:"ExtensionPage-settings"},m("div",{className:""},m("div",{className:"Form"},t.map(this.buildSettingComponent.bind(this)),this.submitButton())))},a.saveSettings=function(e){var a=this;return t.prototype.saveSettings.call(this,e).then((function(){return a.refresh()}))},e}(t.n(_)());const w=flarum.core.compat["common/components/Page"];var v=t.n(w);const k=flarum.core.compat["common/utils/extractText"];var x=t.n(k);const N=flarum.core.compat["common/helpers/icon"];var P=t.n(N),S=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).translationPrefix="foskym-wechat-official.admin.other.",e}o(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e)},a.view=function(){return m("div",{class:"WechatOfficial-ListPage"},m(y(),{className:"Button Button--danger",onclick:this.deleteQRCode.bind(this)},P()("fas fa-trash"),d().translator.trans("foskym-wechat-official.admin.other.delete_qrcode_cache")),m(y(),{className:"Button Button--danger",onclick:this.deleteWechatLink.bind(this)},P()("fas fa-trash"),d().translator.trans("foskym-wechat-official.admin.other.delete_wechat_link")))},a.deleteQRCode=function(){window.confirm(x()(d().translator.trans("foskym-wechat-official.admin.other.delete_qrcode_cache_confirm")))&&d().request({method:"DELETE",url:d().forum.attribute("apiUrl")+"/wechat-official/qrcode"}).then((function(){d().alerts.show({type:"success"},d().translator.trans("foskym-wechat-official.admin.other.delete_qrcode_cache_success")),m.redraw()}))},a.deleteWechatLink=function(){window.confirm(x()(d().translator.trans("foskym-wechat-official.admin.other.delete_wechat_link_confirm")))&&d().request({method:"DELETE",url:d().forum.attribute("apiUrl")+"/wechat-official/qrcode"}).then((function(){d().alerts.show({type:"success"},d().translator.trans("foskym-wechat-official.admin.other.delete_wechat_link_success")),m.redraw()}))},e}(v()),O=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).translationPrefix="foskym-wechat-official.admin.pages.",e.pages={index:b,other:S},e.icons={index:"home",other:"cog"},e}o(e,t);var a=e.prototype;return a.content=function(){var t=m.route.param().page||"index";return m("div",{className:"ExtensionPage-settings WechatOfficial"},m("div",{className:"WechatOfficial-menu"},m("div",{className:"container"},this.menuButtons(t))),m("div",{className:"container WechatOfficial-container"},this.pageContent(t)))},a.menuButtons=function(t){var e=this;return Object.keys(this.pages).map((function(a){return y().component({className:"Button "+(t===a?"item-selected":""),onclick:function(){return m.route.set(d().route("extension",{id:"foskym-wechat-official",page:a}))},icon:e.iconForPage(a)},d().translator.trans(e.translationPrefix+a))}))},a.iconForPage=function(t){return"fas fa-"+this.icons[t]||0},a.pageContent=function(t){var e=this.pages[t];return e?m(e,null):null},e}(p());d().initializers.add("foskym/flarum-wechat-official",(function(){d().extensionData.for("foskym-wechat-official").registerPage(O).registerSetting({setting:"foskym-wechat-official.develop_mode",label:d().translator.trans("foskym-wechat-official.admin.settings.develop_mode_label"),help:d().translator.trans("foskym-wechat-official.admin.settings.develop_mode_description"),type:"boolean"}).registerSetting((function(){var t=this.setting("foskym-wechat-official.develop_mode")();return"0"===t&&(t=!1),m("[",null,m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-wechat-official.admin.settings.app_id_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.app_id"+(t?"_dev":""))})),m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-wechat-official.admin.settings.app_secret_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.app_secret"+(t?"_dev":""))})),m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-wechat-official.admin.settings.token_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.token"+(t?"_dev":""))})),m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-wechat-official.admin.settings.aes_key_label")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.aes_key"+(t?"_dev":""))})))})).registerSetting({setting:"foskym-wechat-official.server_url",label:d().translator.trans("foskym-wechat-official.admin.settings.server_url_label"),help:location.origin+"/api/wechat-official/ping",type:"hidden"}).registerSetting({setting:"foskym-wechat-official.callback_url",label:d().translator.trans("foskym-wechat-official.admin.settings.callback_url_label"),help:d().translator.trans("foskym-wechat-official.admin.settings.callback_url_description"),type:"hidden"}).registerSetting((function(){var t=this.setting("foskym-wechat-official.develop_mode")();if("0"===t&&(t=!1),t)return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-wechat-official.admin.settings.template_message_id_label")),m("div",{class:"helpText"},d().translator.trans("foskym-wechat-official.admin.settings.template_message_id_description")),m("div",{class:"helpText"},"【标题: {{thing01.DATA}} 内容: {{thing02.DATA}} 时间: {{time01.DATA}}\t】"),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-wechat-official.template_message_id")}))})).registerSetting({setting:"foskym-wechat-official.enable_push",label:d().translator.trans("foskym-wechat-official.admin.settings.enable_push_label"),type:"boolean"}).registerSetting({setting:"foskym-wechat-official.enable_login_replace",label:d().translator.trans("foskym-wechat-official.admin.settings.enable_login_replace_label"),help:d().translator.trans("foskym-wechat-official.admin.settings.enable_login_replace_description"),type:"boolean"}).registerSetting({setting:"foskym-wechat-official.enable_unbind",label:d().translator.trans("foskym-wechat-official.admin.settings.enable_unbind_label"),type:"boolean"})}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map