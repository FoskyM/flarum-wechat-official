(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var a in e)t.o(e,a)&&!t.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:e[a]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("foskym/flarum-wechat-official",(function(){console.log("[foskym/flarum-wechat-official] Hello, forum and admin!")}));const e=flarum.core.compat["forum/app"];var a=t.n(e);const n=flarum.core.compat["common/extend"],c=flarum.core.compat["forum/components/NotificationGrid"];var r=t.n(c);const i=flarum.core.compat["forum/components/SettingsPage"];var s=t.n(i);flarum.core.compat["common/components/Alert"];const f=flarum.core.compat["common/components/Button"];var u=t.n(f);const l=flarum.core.compat["common/components/LinkButton"];var p=t.n(l);flarum.core.compat["common/components/Link"],flarum.core.compat["common/components/Page"],flarum.core.compat["common/helpers/icon"];const h=flarum.core.compat["common/models/User"];var d=t.n(h);const w=flarum.core.compat["common/Model"];var k=t.n(w);const b=flarum.core.compat["forum/components/LogInModal"];var y=t.n(b);function g(){var t=a().forum.attribute("foskym-wechat-official.app_id"),o=a().forum.attribute("baseUrl")+"/wechat-official/callback";return"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+encodeURIComponent(o)+"&response_type=code&scope=snsapi_userinfo&state=wechat#wechat_redirect"}function _(){return/MicroMessenger/i.test(navigator.userAgent)}function v(){return/wechat_redirect=true/.test(location.href)}flarum.core.compat["forum/components/IndexPage"],a().initializers.add("foskym/flarum-wechat-official",(function(){d().prototype.WechatAuth=k().attribute("WechatAuth"),(0,n.extend)(r().prototype,"notificationMethods",(function(t){a().forum.attribute("foskym-wechat-official.enable_push")&&t.add("push",{name:"push",icon:"fab fa-weixin",label:a().translator.trans("foskym-wechat-official.forum.settings.push_notification_label")})})),(0,n.extend)(s().prototype,"accountItems",(function(t){var o=this,e=g();t.add("wechat",this.user.WechatAuth().isLinked&&a().forum.attribute("foskym-wechat-official.enable_unbind")?m(u(),{icon:"fab fa-weixin",className:"Button Button--Wechat",onclick:function(){a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/wechat-official/unlink"}).then((function(){o.user.WechatAuth().isLinked=!1,a().alerts.show({type:"success"},a().translator.trans("foskym-wechat-official.forum.settings.wechat_unlink_success")),m.redraw()}))}},a().translator.trans("foskym-wechat-official.forum.settings.wechat_unlink")):m(p(),{icon:"fab fa-weixin",className:"Button Button--Wechat",disabled:this.user.WechatAuth().isLinked,href:e,external:!0},this.user.WechatAuth().isLinked?a().translator.trans("foskym-wechat-official.forum.settings.wechat_linked"):a().translator.trans("foskym-wechat-official.forum.settings.bind_wechat")),-100)})),(0,n.extend)(y().prototype,"oncreate",(function(){if(_()&&!v()&&a().forum.attribute("foskym-wechat-official.enable_login_replace")){var t=g();window.location.href=t}else $(".LogInModal").show()})),document.addEventListener("DOMContentLoaded",(function(){_()&&v()&&(a().session.user?m.route.set("/settings"):setTimeout((function(){a().modal.show(y()),$(".LogInModal").show()}),200))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map